{
  "$schema": "http://json-schema.org/draft-07/schema",
  "type": "object",
  "required": [
    "meta"
  ],
  "definitions": {
    "string": {
      "type": "string",
      "minLength": 1
    },
    "array": {
      "type": "array",
      "minItems": 1,
      "uniqueItems": true
    },
    "array-items-string": {
      "$ref": "#/definitions/array",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "name": {
      "description": "Command name",
      "examples": [
        ""
      ],
      "allOf": [
        {
          "$ref": "#/definitions/string"
        },
        {
          "if": {
            "pattern": " "
          },
          "then": {
            "pattern": "(^\".+\"$)|(^'.+'$)",
            "errorMessage": "If spaces are needed, please use \" or ' to wrap them, for example: 'hello world'"
          }
        }
      ]
    },
    "alias": {
      "description": "Command alias",
      "examples": [
        []
      ],
      "allOf": [
        {
          "$ref": "#/definitions/array-items-string"
        },
        {
          "items": {
            "if": {
              "pattern": " "
            },
            "then": {
              "pattern": "(^\".+\"$)|(^'.+'$)",
              "errorMessage": "If spaces are needed, please use \" or ' to wrap them, for example: 'hello world'"
            }
          }
        }
      ]
    },
    "hide": {
      "markdownDescription": "Hide the current level of completion items\n - Sub-items will not be hidden unless they also set the `hide` property\n - Mainly used to cooperate with hooks to dynamically add completion items, as dynamic addition may cause duplication, so it is necessary to hide the original completion items",
      "type": "boolean",
      "enum": [
        true
      ]
    },
    "tip": {
      "markdownDescription": "Completion item tip\n- General structure of the completion tip: `Usage` + `Description` + `Example`\n- Here is an example:\n```json\n  \"tip\": [\n    \"U: -r, --revisions <REVSETS>\",\n    \"xxx (Here is the description)\",\n    \"E: -r '@-'   --- xxx (Example description)\"\n    \"   -r 'x-'   --- xxx (Example description)\"\n  ]\n  ```",
      "examples": [
        []
      ],
      "allOf": [
        {
          "$ref": "#/definitions/array-items-string"
        },
        {
          "not": {
            "contains": {
              "pattern": "[\\r\\n]"
            }
          },
          "errorMessage": "Each item in the array will automatically add a line break at the end when displayed, so line breaks are not allowed."
        }
      ]
    },
    "item": {
      "type": "object",
      "required": [
        "name"
      ],
      "properties": {
        "name": {
          "$ref": "#/definitions/name"
        },
        "alias": {
          "$ref": "#/definitions/alias"
        },
        "hide": {
          "$ref": "#/definitions/hide"
        },
        "tip": {
          "$ref": "#/definitions/tip"
        },
        "next": {
          "$ref": "#/definitions/next"
        },
        "options": {
          "$ref": "#/definitions/options"
        }
      },
      "additionalProperties": false
    },
    "item_without_options": {
      "type": "object",
      "required": [
        "name"
      ],
      "properties": {
        "name": {
          "$ref": "#/definitions/name"
        },
        "alias": {
          "$ref": "#/definitions/alias"
        },
        "hide": {
          "$ref": "#/definitions/hide"
        },
        "tip": {
          "$ref": "#/definitions/tip"
        },
        "next": {
          "$ref": "#/definitions/options-next"
        }
      },
      "additionalProperties": false
    },
    "item_without_options_next": {
      "type": "object",
      "required": [
        "name"
      ],
      "properties": {
        "name": {
          "$ref": "#/definitions/name"
        },
        "alias": {
          "$ref": "#/definitions/alias"
        },
        "hide": {
          "$ref": "#/definitions/hide"
        },
        "tip": {
          "$ref": "#/definitions/tip"
        }
      },
      "additionalProperties": false
    },
    "next": {
      "markdownDescription": "Next command completion\n- It can be an array or the number `0`\n- If it is an array\n  - Items in the array are automatically added to the completions.\n  - If there are `hooks`, they will be added dynamically.\n- If it is the number `0`\n  - It indicates that a content should be input at this time.\n  - However, [PSCompletions](https://pscompletions.abgox.com) is unable to provide completions, and users need to input manually.\n  - `0` tells [PSCompletions](https://pscompletions.abgox.com) that it should display symbols of the `WriteSpaceTab` type to achieve symbol prediction.",
      "type": [
        "array",
        "number"
      ],
      "examples": [
        []
      ],
      "uniqueItems": true,
      "items": {
        "$ref": "#/definitions/item"
      },
      "if": {
        "type": "number",
        "not": {
          "const": 0
        }
      },
      "then": {
        "not": true,
        "errorMessage": "It must be an array or the number 0"
      }
    },
    "options": {
      "type": "array",
      "uniqueItems": true,
      "markdownDescription": "Option class completion\n - Usually starts with `-` or `--`\n - For example, `--list`",
      "items": {
        "$ref": "#/definitions/item_without_options"
      }
    },
    "options-next": {
      "markdownDescription": "Next command completion\n- It can be an array or the number `0`\n- If it is an array\n  - Items in the array are automatically added to the completions.\n  - If there are `hooks`, they will be added dynamically.\n- If it is the number `0`\n  - It indicates that a content should be input at this time.\n  - However, [PSCompletions](https://pscompletions.abgox.com) is unable to provide completions, and users need to input manually.\n  - `0` tells [PSCompletions](https://pscompletions.abgox.com) that it should display symbols of the `WriteSpaceTab` type to achieve symbol prediction.",
      "type": [
        "array",
        "number"
      ],
      "examples": [
        []
      ],
      "uniqueItems": true,
      "items": {
        "$ref": "#/definitions/item_without_options_next"
      },
      "if": {
        "type": "number",
        "not": {
          "const": 0
        }
      },
      "then": {
        "not": true,
        "errorMessage": "It must be an array or the number 0"
      }
    }
  },
  "properties": {
    "meta": {
      "type": "object",
      "description": "Additional information for the completion command",
      "required": [
        "url",
        "description"
      ],
      "properties": {
        "url": {
          "description": "Homepage or repository address of the completion command",
          "allOf": [
            {
              "$ref": "#/definitions/string"
            },
            {
              "pattern": "^https?://",
              "errorMessage": "It must be a valid http/https URL"
            }
          ]
        },
        "description": {
          "description": "Description of the completion command",
          "allOf": [
            {
              "$ref": "#/definitions/array-items-string"
            },
            {
              "not": {
                "contains": {
                  "pattern": "\\n"
                }
              },
              "errorMessage": "Each item in the array will automatically add a line break at the end when displayed, so line breaks are not allowed."
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "root": {
      "description": "Root command",
      "$ref": "#/definitions/array",
      "items": {
        "$ref": "#/definitions/item"
      }
    },
    "options": {
      "markdownDescription": "Optional completion for the root command\n- If there is only one root command other than optional completions, they will be displayed\n- Unless you have used it or its alias",
      "$ref": "#/definitions/array",
      "items": {
        "$ref": "#/definitions/item_without_options"
      }
    },
    "common_options": {
      "markdownDescription": "Common optional completion\n- Any time you trigger completion, they will be displayed\n- Unless you have used it or its alias",
      "$ref": "#/definitions/array",
      "items": {
        "$ref": "#/definitions/item_without_options"
      }
    },
    "config": {
      "description": "Special configuration items for the completion command",
      "$ref": "#/definitions/array",
      "items": {
        "type": "object",
        "required": [
          "name",
          "value",
          "tip"
        ],
        "properties": {
          "name": {
            "description": "Name of the special configuration item",
            "$ref": "#/definitions/string"
          },
          "value": {
            "description": "Default value of the special configuration item",
            "type": [
              "string",
              "number"
            ]
          },
          "values": {
            "markdownDescription": "Optional values of the special configuration item\n- Here, you can fill in the values that will be displayed when the command completion is triggered\n - Suppose the command completion is `xxx` and the configuration item name is `enable_xxx`\n - Then, when you input `psc completion xxx enable_xxx` and trigger completion, the values in the `values` array will be displayed in the completion list",
            "$ref": "#/definitions/array",
            "items": {
              "type": [
                "string",
                "number"
              ]
            }
          },
          "tip": {
            "description": "Tip information for the special configuration item",
            "$ref": "#/definitions/array-items-string"
          }
        }
      }
    },
    "info": {
      "markdownDescription": "Additional information\n- They can be accessed in the `tip` field of this json file using `{{ $info.xxx }}`\n- If you need to add line breaks, please use `\\n`",
      "type": "object",
      "minProperties": 1
    }
  },
  "additionalProperties": false
}
